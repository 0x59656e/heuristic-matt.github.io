<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Self-hosted K8s: Setting Up - Adrian&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Adrian&#039;s Blog"><meta name="msapplication-TileImage" content="https://cdn.jsdelivr.net/gh/Dumb-Tiger/image_repository/L_TOKYO-TAWA.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Adrian&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="This post describes how to set up a self-hosted K8s cluster from scratch, by just using an old computer at home."><meta property="og:type" content="blog"><meta property="og:title" content="Self-hosted K8s: Setting Up"><meta property="og:url" content="https://dumb-tiger.github.io/2021/07/11/Self-hosted-K8s-Setting-Up/"><meta property="og:site_name" content="Adrian&#039;s Blog"><meta property="og:description" content="This post describes how to set up a self-hosted K8s cluster from scratch, by just using an old computer at home."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Dumb-Tiger/image_repository/Self-hosted-K8s-Setting-Up-unsplash.jpg"><meta property="article:published_time" content="2021-07-11T09:48:55.000Z"><meta property="article:modified_time" content="2021-07-15T14:22:09.002Z"><meta property="article:author" content="Adrian Hu"><meta property="article:tag" content="K8s"><meta property="article:tag" content="Ingress"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://cdn.jsdelivr.net/gh/Dumb-Tiger/image_repository/Self-hosted-K8s-Setting-Up-unsplash.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://dumb-tiger.github.io/2021/07/11/Self-hosted-K8s-Setting-Up/"},"headline":"Self-hosted K8s: Setting Up","image":["https://cdn.jsdelivr.net/gh/Dumb-Tiger/image_repository/Self-hosted-K8s-Setting-Up-unsplash.jpg"],"datePublished":"2021-07-11T09:48:55.000Z","dateModified":"2021-07-15T14:22:09.002Z","author":{"@type":"Person","name":"Adrian Hu"},"publisher":{"@type":"Organization","name":"Adrian's Blog","logo":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/Dumb-Tiger/image_repository/L_TOKYO-TAWA.svg"}},"description":"This post describes how to set up a self-hosted K8s cluster from scratch, by just using an old computer at home."}</script><link rel="canonical" href="https://dumb-tiger.github.io/2021/07/11/Self-hosted-K8s-Setting-Up/"><link rel="icon" href="https://cdn.jsdelivr.net/gh/Dumb-Tiger/image_repository/L_TOKYO-TAWA.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/github-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://cdn.jsdelivr.net/gh/Dumb-Tiger/image_repository/L_TOKYO-TAWA.svg" alt="Adrian&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Posts</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://cdn.jsdelivr.net/gh/Dumb-Tiger/image_repository/Self-hosted-K8s-Setting-Up-unsplash.jpg" alt="Self-hosted K8s: Setting Up"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-07-11T09:48:55.000Z" title="7/11/2021, 5:48:55 PM">2021-07-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-07-15T14:22:09.002Z" title="7/15/2021, 10:22:09 PM">2021-07-15</time></span><span class="level-item"><a class="link-muted" href="/categories/Cloud-Native/">Cloud Native</a></span></div></div><h1 class="title is-3 is-size-4-mobile">Self-hosted K8s: Setting Up</h1><div class="content"><p>This post describes how to set up a self-hosted K8s cluster from scratch, by just using an old computer at home.</p>
<p><escape><span id="more"></span></escape></p>
<h1 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h1><figure class="highlight bash"><figcaption><span>Server(PC) Spec. >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># lscpu</span></span><br><span class="line">Architecture:          x86_64</span><br><span class="line">CPU op-mode(s):        32-bit, 64-bit</span><br><span class="line">Byte Order:            Little Endian</span><br><span class="line">CPU(s):                8</span><br><span class="line">On-line CPU(s) list:   0-7</span><br><span class="line">Thread(s) per core:    2</span><br><span class="line">Core(s) per socket:    4</span><br><span class="line">Socket(s):             1</span><br><span class="line">NUMA node(s):          1</span><br><span class="line">Vendor ID:             GenuineIntel</span><br><span class="line">CPU family:            6</span><br><span class="line">Model:                 94</span><br><span class="line">Model name:            Intel(R) Core(TM) i7-6770HQ CPU @ 2.60GHz</span><br><span class="line">Stepping:              3</span><br><span class="line">CPU MHz:               833.129</span><br><span class="line">CPU max MHz:           3500.0000</span><br><span class="line">CPU min MHz:           800.0000</span><br><span class="line">BogoMIPS:              5184.00</span><br><span class="line">Virtualization:        VT-x</span><br><span class="line">L1d cache:             32K</span><br><span class="line">L1i cache:             32K</span><br><span class="line">L2 cache:              256K</span><br><span class="line">L3 cache:              6144K</span><br><span class="line">NUMA node0 CPU(s):     0-7</span><br><span class="line">Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch epb invpcid_single intel_pt ssbd ibrs ibpb stibp tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx rdseed adx smap clflushopt xsaveopt xsavec xgetbv1 dtherm ida arat pln pts hwp hwp_notify hwp_act_window hwp_epp md_clear spec_ctrl intel_stibp flush_l1d</span><br><span class="line">[root@dev ~]<span class="comment"># cat /proc/meminfo</span></span><br><span class="line">MemTotal:       16317680 kB</span><br><span class="line">MemFree:        14494044 kB</span><br><span class="line">MemAvailable:   14841560 kB</span><br><span class="line">Buffers:            2120 kB</span><br><span class="line">Cached:           600708 kB</span><br><span class="line">SwapCached:            0 kB</span><br><span class="line">Active:          1002416 kB</span><br><span class="line">Inactive:         498124 kB</span><br><span class="line">Active(anon):     898416 kB</span><br><span class="line">Inactive(anon):    10536 kB</span><br><span class="line">Active(file):     104000 kB</span><br><span class="line">Inactive(file):   487588 kB</span><br><span class="line">Unevictable:           0 kB</span><br><span class="line">Mlocked:               0 kB</span><br><span class="line">SwapTotal:             0 kB</span><br><span class="line">SwapFree:              0 kB</span><br><span class="line">Dirty:              1048 kB</span><br><span class="line">Writeback:             0 kB</span><br><span class="line">AnonPages:        897840 kB</span><br><span class="line">Mapped:           209356 kB</span><br><span class="line">Shmem:             11240 kB</span><br><span class="line">Slab:              75176 kB</span><br><span class="line">SReclaimable:      35656 kB</span><br><span class="line">SUnreclaim:        39520 kB</span><br><span class="line">KernelStack:       11216 kB</span><br><span class="line">PageTables:         9608 kB</span><br><span class="line">NFS_Unstable:          0 kB</span><br><span class="line">Bounce:                0 kB</span><br><span class="line">WritebackTmp:          0 kB</span><br><span class="line">CommitLimit:     8158840 kB</span><br><span class="line">Committed_AS:    5102612 kB</span><br><span class="line">VmallocTotal:   34359738367 kB</span><br><span class="line">VmallocUsed:      576216 kB</span><br><span class="line">VmallocChunk:   34358423548 kB</span><br><span class="line">Percpu:             3232 kB</span><br><span class="line">HardwareCorrupted:     0 kB</span><br><span class="line">AnonHugePages:    618496 kB</span><br><span class="line">CmaTotal:              0 kB</span><br><span class="line">CmaFree:               0 kB</span><br><span class="line">HugePages_Total:       0</span><br><span class="line">HugePages_Free:        0</span><br><span class="line">HugePages_Rsvd:        0</span><br><span class="line">HugePages_Surp:        0</span><br><span class="line">Hugepagesize:       2048 kB</span><br><span class="line">DirectMap4k:       97744 kB</span><br><span class="line">DirectMap2M:     3983360 kB</span><br><span class="line">DirectMap1G:    12582912 kB</span><br></pre></td></tr></table></figure>

<h1 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h1><h2 id="Disable-Firewall"><a href="#Disable-Firewall" class="headerlink" title="Disable Firewall"></a>Disable Firewall</h2><p><code>systemctl stop firewalld</code><br><code>systemctl disable firewalld</code></p>
<h2 id="Disable-SELINUX"><a href="#Disable-SELINUX" class="headerlink" title="Disable SELINUX"></a>Disable SELINUX</h2><p><code>sed -i &#39;s/enforcing/disabled/&#39; /etc/selinux/config</code></p>
<h2 id="Disable-swap"><a href="#Disable-swap" class="headerlink" title="Disable swap"></a>Disable <code>swap</code></h2><p>First <code>swapoff -a</code> to temporarily turn off <code>swap</code>, then comment out the swap partition in <code>/etc/fstab</code> to disable it permanently.</p>
<p><code>#/dev/mapper/centos-swap swap swap defaults 0 0</code></p>
<h2 id="Set-up-hostname"><a href="#Set-up-hostname" class="headerlink" title="Set up hostname"></a><strong>Set up hostname</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># hostnamectl set-hostname dev.local</span></span><br><span class="line">[root@dev ~]<span class="comment"># hostnamectl status</span></span><br><span class="line">   Static hostname: dev.local</span><br><span class="line">         Icon name: computer-desktop</span><br><span class="line">           Chassis: desktop</span><br><span class="line">        Machine ID: db95018bfd674a19ab4877b4c18add20</span><br><span class="line">           Boot ID: 420cdaba8c694200afcd1b1a0fa34178</span><br><span class="line">  Operating System: CentOS Linux 7 (Core)</span><br><span class="line">       CPE OS Name: cpe:/o:centos:centos:7</span><br><span class="line">            Kernel: Linux 3.10.0-1160.31.1.el7.x86_64</span><br><span class="line">      Architecture: x86-64</span><br></pre></td></tr></table></figure>

<h2 id="Edit-local-hosts-file"><a href="#Edit-local-hosts-file" class="headerlink" title="Edit local hosts file"></a><strong>Edit local <code>hosts</code> file</strong></h2><p>Just because I don’t want to set up bind for just several local domain name.</p>
<p>If you have other nodes, don’t forget to add the hostnames in the master node’s <code>hosts</code> file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line">192.168.50.64 k8s-dashboard.dev.local</span><br><span class="line">192.168.50.64 dev.local</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="NTP-Update"><a href="#NTP-Update" class="headerlink" title="NTP Update"></a>NTP Update</h2><p>Actually I update the <code>ntp</code> during the OS installation.</p>
<p><code>ntpdate time.windows.com</code></p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc."></a>Misc.</h2><p>These configuration may not concern the deployment of K3s, but I’ll do it anyway for a newly installed server.</p>
<h2 id="Install-docker-ce-docker-ce-cli-and-containerd-io"><a href="#Install-docker-ce-docker-ce-cli-and-containerd-io" class="headerlink" title="Install docker-ce, docker-ce-cli and containerd.io"></a>Install <code>docker-ce</code>, <code>docker-ce-cli</code> and <code>containerd.io</code></h2><p>As I would like to use <code>docker</code> on this server, so I install it personally. </p>
<p>Install the <code>yum-utils</code> package, which provides the <code>yum-config-manager</code> utility,  and set up the <strong>stable</strong> repository.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    &lt;https://download.docker.com/linux/centos/docker-ce.repo&gt;\</span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<p>Start docker and check if it works.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@dev-server ~]# systemctl start docker</span><br><span class="line">[root@dev-server ~]# systemctl enable docker</span><br><span class="line">[root@dev-server ~]# docker run hello-world</span><br><span class="line">Unable to find image &#x27;hello-world:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">b8dfde127a29: Pull complete</span><br><span class="line">Digest: sha256:9f6ad537c5132bcce57f7a0a20e317228d382c3cd61edae14650eec68b2b345c</span><br><span class="line">Status: Downloaded newer image for hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> &lt;https://hub.docker.com/&gt;</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> &lt;https://docs.docker.com/get-started/&gt;</span><br></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><strong>Disable ipv6</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br><span class="line">net.ipv6.conf.all.disable_ipv6 = 1</span><br><span class="line">net.ipv6.conf.default.disable_ipv6 = 1</span><br><span class="line"></span><br><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line">....</span><br><span class="line">AddressFamily inet</span><br></pre></td></tr></table></figure>

<p><strong>Add name servers to evade from Gov(CN) DNS pollution</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># nmcli connection show</span></span><br><span class="line">NAME  UUID                                  TYPE      DEVICE</span><br><span class="line">eno1  3e5fb656-a48e-4902-8ea8-86a9d8e0cdc6  ethernet  eno1</span><br><span class="line">[root@localhost etc]<span class="comment"># nmcli connection modify eno1 ipv4.dns &quot;1.1.1.1 119.29.29.29&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="Setting-Up-K3s"><a href="#Setting-Up-K3s" class="headerlink" title="Setting Up K3s"></a>Setting Up K3s</h1><p><code>K3s</code> by default uses <a target="_blank" rel="noopener" href="https://doc.traefik.io/traefik/"><code>Traefik</code></a> as the <code>Ingress Controller</code>. </p>
<p>As I prefer to use <code>Nginx</code> instead, thus adding the following variable to exclude <code>traefik</code> installation.</p>
<p><code>curl -sfL [https://get.k3s.io](https://get.k3s.io/) | INSTALL_K3S_EXEC=&quot;--disable traefik&quot; sh</code></p>
<p>As mentioned in the <a target="_blank" rel="noopener" href="https://rancher.com/docs/k3s/latest/en/cluster-access/">K3s doc</a>, we have to export <code>KUBECONFIG</code> to enable command line tools like <code>kubectl</code> and <code>helm</code> to work properly.</p>
<p>Add the following to <code>~/.bashrc</code></p>
<p><code>export KUBECONFIG=/etc/rancher/k3s/k3s.yaml</code></p>
<h2 id="Install-Helm"><a href="#Install-Helm" class="headerlink" title="Install Helm"></a>Install Helm</h2><p>To install <code>Helm</code>, just download the binary file then put it under the <code>/usr/local/bin</code> with proper permission.</p>
<h2 id="Add-and-Update-Helm-Repository"><a href="#Add-and-Update-Helm-Repository" class="headerlink" title="Add and Update Helm Repository"></a><strong>Add and Update Helm Repository</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># helm repo add stable https://charts.helm.sh/stable</span></span><br><span class="line"><span class="string">&quot;stable&quot;</span> has been added to your repositories</span><br><span class="line"><span class="comment"># helm repo add bitnami https://charts.bitnami.com/bitnami</span></span><br><span class="line"><span class="string">&quot;bitnami&quot;</span> has been added to your repositories</span><br><span class="line"><span class="comment"># helm repo list</span></span><br><span class="line">NAME    	URL</span><br><span class="line">stable  	https://charts.helm.sh/stable</span><br><span class="line">bitnami 	https://charts.bitnami.com/bitnami</span><br><span class="line"><span class="comment"># helm repo update</span></span><br><span class="line">Hang tight <span class="keyword">while</span> we grab the latest from your chart repositories...</span><br><span class="line">...Successfully got an update from the <span class="string">&quot;bitnami&quot;</span> chart repository</span><br><span class="line">...Successfully got an update from the <span class="string">&quot;stable&quot;</span> chart repository</span><br><span class="line">Update Complete. ⎈Happy Helming!⎈</span><br></pre></td></tr></table></figure>

<h2 id="Install-nginx-ingress-controller-by-Helm-Chart"><a href="#Install-nginx-ingress-controller-by-Helm-Chart" class="headerlink" title="Install nginx-ingress-controller by Helm Chart"></a>Install <code>nginx-ingress-controller</code> by Helm Chart</h2><p>First I dump the configurable values into a local file for further customizing.</p>
<p><code>helm show values ingress-nginx/ingress-nginx &gt; values.yml</code></p>
<p>Then I pick up some attributes to make a tiny <code>values.yml</code>.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Required on CNI based K8s installations, since CNI and hostport don&#x27;t mix yet.</span></span><br><span class="line"><span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Optionally, change this to ClusterFirstWithHostNet in case you have &#x27;hostNetwork: true&#x27;.</span></span><br><span class="line"><span class="comment">## By default, while using host network, name resolution uses the host&#x27;s DNS. If you wish nginx-controller</span></span><br><span class="line"><span class="comment">## to keep resolving names inside the k8s network, use ClusterFirstWithHostNet.</span></span><br><span class="line"><span class="attr">dnsPolicy:</span> <span class="string">ClusterFirstWithHostNet</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Service parameters</span></span><br><span class="line"><span class="comment">## Use NodePort to expose services to my client machine.</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br></pre></td></tr></table></figure>

<p>After the installation, you will see results like this.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">NAME:</span> <span class="string">nginx-ingress-controller</span></span><br><span class="line"><span class="attr">LAST DEPLOYED:</span> <span class="string">Thu</span> <span class="string">Jul</span>  <span class="number">8</span> <span class="number">01</span><span class="string">:30:46</span> <span class="number">2021</span></span><br><span class="line"><span class="attr">NAMESPACE:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">STATUS:</span> <span class="string">deployed</span></span><br><span class="line"><span class="attr">REVISION:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">TEST SUITE:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">NOTES:</span></span><br><span class="line"><span class="string">**</span> <span class="string">Please</span> <span class="string">be</span> <span class="string">patient</span> <span class="string">while</span> <span class="string">the</span> <span class="string">chart</span> <span class="string">is</span> <span class="string">being</span> <span class="string">deployed</span> <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="string">The</span> <span class="string">nginx-ingress</span> <span class="string">controller</span> <span class="string">has</span> <span class="string">been</span> <span class="string">installed.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Get the application URL by running these commands:</span></span><br><span class="line">    <span class="string">export</span> <span class="string">HTTP_NODE_PORT=$(kubectl</span> <span class="string">--namespace</span> <span class="string">default</span> <span class="string">get</span> <span class="string">services</span> <span class="string">-o</span> <span class="string">jsonpath=&quot;&#123;.spec.ports[0].nodePort&#125;&quot;</span> <span class="string">nginx-ingress-controller)</span></span><br><span class="line">    <span class="string">export</span> <span class="string">HTTPS_NODE_PORT=$(kubectl</span> <span class="string">--namespace</span> <span class="string">default</span> <span class="string">get</span> <span class="string">services</span> <span class="string">-o</span> <span class="string">jsonpath=&quot;&#123;.spec.ports[1].nodePort&#125;&quot;</span> <span class="string">nginx-ingress-controller)</span></span><br><span class="line">    <span class="string">export</span> <span class="string">NODE_IP=$(kubectl</span> <span class="string">--namespace</span> <span class="string">default</span> <span class="string">get</span> <span class="string">nodes</span> <span class="string">-o</span> <span class="string">jsonpath=&quot;&#123;.items[0].status.addresses[1].address&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="string">echo</span> <span class="string">&quot;Visit http://$NODE_IP:$HTTP_NODE_PORT to access your application via HTTP.&quot;</span></span><br><span class="line">    <span class="string">echo</span> <span class="string">&quot;Visit https://$NODE_IP:$HTTPS_NODE_PORT to access your application via HTTPS.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">An example Ingress that makes use of the controller:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">example</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">foo</span></span><br><span class="line">  <span class="attr">spec:</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">www.example.com</span></span><br><span class="line">        <span class="attr">http:</span></span><br><span class="line">          <span class="attr">paths:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">                <span class="attr">service:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">exampleService</span></span><br><span class="line">                  <span class="attr">port:</span></span><br><span class="line">                    <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">              <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">    <span class="comment"># This section is only required if TLS is to be enabled for the Ingress</span></span><br><span class="line">    <span class="attr">tls:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">www.example.com</span></span><br><span class="line">          <span class="attr">secretName:</span> <span class="string">example-tls</span></span><br><span class="line"></span><br><span class="line"><span class="string">If</span> <span class="string">TLS</span> <span class="string">is</span> <span class="string">enabled</span> <span class="string">for</span> <span class="string">the</span> <span class="string">Ingress,</span> <span class="attr">a Secret containing the certificate and key must also be provided:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">example-tls</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">foo</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">tls.crt:</span> <span class="string">&lt;base64</span> <span class="string">encoded</span> <span class="string">cert&gt;</span></span><br><span class="line">    <span class="attr">tls.key:</span> <span class="string">&lt;base64</span> <span class="string">encoded</span> <span class="string">key&gt;</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">kubernetes.io/tls</span></span><br></pre></td></tr></table></figure>

<h2 id="Bash-Completion-for-Command-Line-Tools"><a href="#Bash-Completion-for-Command-Line-Tools" class="headerlink" title="Bash Completion for Command Line Tools"></a>Bash Completion for Command Line Tools</h2><p>Auto-completion makes your life easier.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install bash-completion</span><br><span class="line">kubectl completion bash &gt;/etc/bash_completion.d/kubectl</span><br><span class="line">helm completion bash &gt; /etc/bash_completion.d/helm</span><br></pre></td></tr></table></figure>

<h1 id="Deploy-Kubernetes-Dashboard"><a href="#Deploy-Kubernetes-Dashboard" class="headerlink" title="Deploy Kubernetes Dashboard"></a>Deploy Kubernetes Dashboard</h1><h2 id="Prerequisite-for-HTTPs"><a href="#Prerequisite-for-HTTPs" class="headerlink" title="Prerequisite for HTTPs"></a>Prerequisite for HTTPs</h2><p>To visit our dashboard via HTTPS, we need to specify a <code>TLS secret</code> in our <code>values.yml</code>. </p>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/configuration/secret/#tls-secrets">Kubernetes Secret # tls-secrets</a></p>
<blockquote>
<p>Kubernetes provides a builtin Secret type <code>kubernetes.io/tls</code> for storing a certificate and its associated key that are typically used for TLS . This data is primarily used with TLS termination of the Ingress resource, but may be used with other resources or directly by a workload. When using this type of Secret, the <code>tls.key</code> and the <code>tls.crt</code> key must be provided in the <code>data</code> (or <code>stringData</code>) field of the Secret configuration, although the API server doesn’t actually validate the values for each key.</p>
</blockquote>
<p>To create it, we first generate a self-signed certification by using <code>openssl</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl req -newkey rsa:2048 \</span><br><span class="line">-nodes -keyout k8s-dashboard-dev-local-key.pem -x509 \</span><br><span class="line">-days 3650 -out k8s-dashboard-dev-local-certificate.pem \</span><br><span class="line">-subj <span class="string">&quot;/CN=k8s-dashboard.dev.local&quot;</span></span><br></pre></td></tr></table></figure>

<p>You’ll see the key and cert files in the current directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@dev secrets]<span class="comment"># l</span></span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x   2 root root  150 Jul 10 22:50 .</span><br><span class="line">dr-xr-x---. 12 root root 4096 Jul 10 22:31 ..</span><br><span class="line">-rw-r--r--   1 root root 1131 Jul 10 22:50 k8s-dashboard-dev-local-certificate.pem</span><br><span class="line">-rw-r--r--   1 root root 1704 Jul 10 22:50 k8s-dashboard-dev-local-key.pem</span><br></pre></td></tr></table></figure>

<p>Then we use them to create the secret.</p>
<blockquote>
<p>When creating a TLS Secret using <code>kubectl</code>, you can use the <code>tls</code> subcommand as shown in the following example:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret tls my-tls-secret\</span><br><span class="line">  --cert=path/to/cert/file\</span><br><span class="line">  --key=path/to/key/file</span><br></pre></td></tr></table></figure>

<h2 id="Create-Service-Account-and-Role-Binding"><a href="#Create-Service-Account-and-Role-Binding" class="headerlink" title="Create Service Account and Role Binding"></a>Create Service Account and Role Binding</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># cat &lt;&lt; EOF | kubectl apply -f -</span></span><br><span class="line">&gt; apiVersion: v1</span><br><span class="line">&gt; kind: ServiceAccount</span><br><span class="line">&gt; metadata:</span><br><span class="line">&gt;   name: admin-user</span><br><span class="line">&gt;   namespace: default</span><br><span class="line">&gt; ---</span><br><span class="line">&gt; apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">&gt; kind: ClusterRoleBinding</span><br><span class="line">&gt; metadata:</span><br><span class="line">&gt;   name: admin-user</span><br><span class="line">&gt; roleRef:</span><br><span class="line">&gt;   apiGroup: rbac.authorization.k8s.io</span><br><span class="line">&gt;   kind: ClusterRole</span><br><span class="line">&gt;   name: cluster-admin</span><br><span class="line">&gt; subjects:</span><br><span class="line">&gt; - kind: ServiceAccount</span><br><span class="line">&gt;   name: admin-user</span><br><span class="line">&gt;   namespace: default</span><br><span class="line">&gt; EOF</span><br><span class="line">serviceaccount/admin-user created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/admin-user created</span><br><span class="line">[root@dev ~]<span class="comment"># kubectl -n default get secret $(kubectl -n default get sa/admin-user -o jsonpath=&quot;&#123;.secrets[0].name&#125;&quot;) -o go-template=&quot;&#123;&#123;.data.token | base64decode&#125;&#125;&quot;</span></span><br><span class="line"><span class="comment"># The Secret Goes Here</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="Prepare-values-yml-and-Install-the-Helm-Chart"><a href="#Prepare-values-yml-and-Install-the-Helm-Chart" class="headerlink" title="Prepare values.yml and Install the Helm Chart"></a>Prepare <code>values.yml</code> and Install the Helm Chart</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@dev kube-yml]# cat &lt;&lt; EOF &gt; values.yml</span><br><span class="line">&gt; service:</span><br><span class="line">&gt;   type: NodePort</span><br><span class="line">&gt;   externalPort: 443</span><br><span class="line">&gt; ingress:</span><br><span class="line">&gt;   enabled: true</span><br><span class="line">&gt;   hosts:</span><br><span class="line">&gt;     - k8s-dashboard.dev.local</span><br><span class="line">&gt;   annotations:</span><br><span class="line">&gt;     nginx.ingress.kubernetes.io/backend-protocol: &quot;HTTPS&quot;</span><br><span class="line">&gt;   tls:</span><br><span class="line">&gt;     - secretName: k8s-dashboard-local-dev-secret</span><br><span class="line">&gt;       hosts:</span><br><span class="line">&gt;         - k8s-dashboard.dev.local</span><br><span class="line">&gt; EOF</span><br></pre></td></tr></table></figure>

<p><code>helm install -f ~/kube-yml/values.yml kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard</code></p>
<p>You will see output like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NAME: kubernetes-dashboard</span><br><span class="line">LAST DEPLOYED: Sat Jul 10 22:16:29 2021</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">*********************************************************************************</span><br><span class="line">*** PLEASE BE PATIENT: kubernetes-dashboard may take a few minutes to install ***</span><br><span class="line">*********************************************************************************</span><br><span class="line">From outside the cluster, the server URL(s) are:</span><br><span class="line">     https://k8s-dashboard.dev.local</span><br></pre></td></tr></table></figure>

<h2 id="Check-the-Dashboard"><a href="#Check-the-Dashboard" class="headerlink" title="Check the Dashboard"></a>Check the Dashboard</h2><p><img src="https://cdn.jsdelivr.net/gh/Dumb-Tiger/image_repository/K8s-dashboard.png" alt="Kubernetes Dashboard"></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Self-hosted K8s: Setting Up</p><p><a href="https://dumb-tiger.github.io/2021/07/11/Self-hosted-K8s-Setting-Up/">https://dumb-tiger.github.io/2021/07/11/Self-hosted-K8s-Setting-Up/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Adrian Hu</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-07-11</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2021-07-15</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/K8s/">K8s</a><a class="link-muted mr-2" rel="tag" href="/tags/Ingress/">Ingress</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/07/21/An-Excursion-of-Linux-Dot-Files-at-Home/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">An Excursion of Linux: Dot Files at Home</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/06/30/Hexo-Up-and-Running-a-Github-Page-Hosted-Way/"><span class="level-item">Hexo Up and Running, a Github Page Hosted Way</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Environment"><span class="level-left"><span class="level-item">1</span><span class="level-item">Environment</span></span></a></li><li><a class="level is-mobile" href="#Prerequisite"><span class="level-left"><span class="level-item">2</span><span class="level-item">Prerequisite</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Disable-Firewall"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Disable Firewall</span></span></a></li><li><a class="level is-mobile" href="#Disable-SELINUX"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Disable SELINUX</span></span></a></li><li><a class="level is-mobile" href="#Disable-swap"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">Disable swap</span></span></a></li><li><a class="level is-mobile" href="#Set-up-hostname"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">Set up hostname</span></span></a></li><li><a class="level is-mobile" href="#Edit-local-hosts-file"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">Edit local hosts file</span></span></a></li><li><a class="level is-mobile" href="#NTP-Update"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">NTP Update</span></span></a></li><li><a class="level is-mobile" href="#Misc"><span class="level-left"><span class="level-item">2.7</span><span class="level-item">Misc.</span></span></a></li><li><a class="level is-mobile" href="#Install-docker-ce-docker-ce-cli-and-containerd-io"><span class="level-left"><span class="level-item">2.8</span><span class="level-item">Install docker-ce, docker-ce-cli and containerd.io</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">2.9</span><span class="level-item"> </span></span></a></li></ul></li><li><a class="level is-mobile" href="#Setting-Up-K3s"><span class="level-left"><span class="level-item">3</span><span class="level-item">Setting Up K3s</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Install-Helm"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">Install Helm</span></span></a></li><li><a class="level is-mobile" href="#Add-and-Update-Helm-Repository"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Add and Update Helm Repository</span></span></a></li><li><a class="level is-mobile" href="#Install-nginx-ingress-controller-by-Helm-Chart"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">Install nginx-ingress-controller by Helm Chart</span></span></a></li><li><a class="level is-mobile" href="#Bash-Completion-for-Command-Line-Tools"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">Bash Completion for Command Line Tools</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Deploy-Kubernetes-Dashboard"><span class="level-left"><span class="level-item">4</span><span class="level-item">Deploy Kubernetes Dashboard</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Prerequisite-for-HTTPs"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">Prerequisite for HTTPs</span></span></a></li><li><a class="level is-mobile" href="#Create-Service-Account-and-Role-Binding"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">Create Service Account and Role Binding</span></span></a></li><li><a class="level is-mobile" href="#Prepare-values-yml-and-Install-the-Helm-Chart"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">Prepare values.yml and Install the Helm Chart</span></span></a></li><li><a class="level is-mobile" href="#Check-the-Dashboard"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">Check the Dashboard</span></span></a></li></ul></li></ul></div></div><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Blog/"><span class="level-start"><span class="level-item">Blog</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Cloud-Native/"><span class="level-start"><span class="level-item">Cloud Native</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/Cloud-Native/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Cloud-Native/Event-Monitoring-and-Alerting/"><span class="level-start"><span class="level-item">Event Monitoring and Alerting</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Database/Cloud-Native/"><span class="level-start"><span class="level-item">Cloud Native</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Productivity/"><span class="level-start"><span class="level-item">Productivity</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">October 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">July 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">June 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cheatsheet/"><span class="tag">Cheatsheet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cloudflare/"><span class="tag">Cloudflare</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Command-Line/"><span class="tag">Command Line</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DNS/"><span class="tag">DNS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dot-Files/"><span class="tag">Dot Files</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FHS/"><span class="tag">FHS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GNU/"><span class="tag">GNU</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GitHub/"><span class="tag">GitHub</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Helm/"><span class="tag">Helm</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/I-O/"><span class="tag">I/O</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ingress/"><span class="tag">Ingress</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/K8s/"><span class="tag">K8s</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Key-Binding/"><span class="tag">Key Binding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Pattern-Matching/"><span class="tag">Pattern Matching</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Process/"><span class="tag">Process</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Prometheous/"><span class="tag">Prometheous</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ProxyChains/"><span class="tag">ProxyChains</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shadowsocks/"><span class="tag">Shadowsocks</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/V2Ray/"><span class="tag">V2Ray</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cheatsheet/"><span class="tag">cheatsheet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/man/"><span class="tag">man</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://cdn.jsdelivr.net/gh/Dumb-Tiger/image_repository/tiger-avatar.jpg" alt="Adrian Hu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Adrian Hu</p><p class="is-size-6 is-block">Devops</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shanghai, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">9</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">25</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Dumb-Tiger" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Dumb-Tiger"><i class="fab fa-github"></i></a></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://cdn.jsdelivr.net/gh/Dumb-Tiger/image_repository/L_TOKYO-TAWA.svg" alt="Adrian&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2021 Adrian Hu</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>